
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>ç´…æ©‹äº¤é€šç›£æ§ - æ——è‰¦ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 font-sans">
    <div class="container mx-auto p-4 max-w-5xl">
        <header class="mb-6 text-center border-b border-slate-700 pb-4">
            <h1 class="text-2xl font-bold text-blue-400">ğŸš¦ æ·±åœ³ç£/ç´…æ©‹ å¯¦æ™‚å„€è¡¨æ¿</h1>
            <p class="text-[10px] text-slate-500 mt-1">æ•¸æ“šæ¯ 30 ç§’è‡ªå‹•åŒæ­¥</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-slate-800 p-5 rounded-2xl shadow-2xl border border-blue-500/20">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-blue-400 font-bold">å¾€æ·±åœ³ç£å£å²¸ (B3X)</h2>
                        <p class="text-[10px] text-slate-400">ç«™é»ï¼šç´…æ©‹ (Northbound)</p>
                    </div>
                    <div class="text-right">
                        <div id="eta-north" class="text-3xl font-mono text-emerald-400 font-bold">--</div>
                        <div id="load-north" class="text-[10px] text-slate-400 mt-1">è¼‰å…¥ä¸­...</div>
                    </div>
                </div>
                <div class="aspect-video bg-black rounded-xl overflow-hidden border border-slate-700">
                    <img id="cctv-north" src="https://tdcctv.data.gov.hk/NT426F.JPG" referrerpolicy="no-referrer" class="w-full h-full object-cover">
                </div>
            </div>

            <div class="bg-slate-800 p-5 rounded-2xl shadow-2xl border border-orange-500/20">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-orange-400 font-bold">å¾€å±¯é–€/ä¹é¾ (B3X)</h2>
                        <p class="text-[10px] text-slate-400">ç«™é»ï¼šç´…æ©‹ (Southbound)</p>
                    </div>
                    <div class="text-right">
                        <div id="eta-south" class="text-3xl font-mono text-emerald-400 font-bold">--</div>
                        <div id="load-south" class="text-[10px] text-slate-400 mt-1">è¼‰å…¥ä¸­...</div>
                    </div>
                </div>
                <div class="aspect-video bg-black rounded-xl overflow-hidden border border-slate-700">
                    <img id="cctv-south" src="https://tdcctv.data.gov.hk/NT423F.JPG" referrerpolicy="no-referrer" class="w-full h-full object-cover">
                </div>
            </div>
        </div>

        <div class="mt-8 text-center">
            <button onclick="updateAll()" class="bg-slate-700 hover:bg-blue-600 text-white px-8 py-3 rounded-full text-sm transition-all shadow-lg">
                æ‰‹å‹•é‡æ–°è¼‰å…¥æ‰€æœ‰æ•¸æ“š
            </button>
        </div>
    </div>

    <script>
        const CROWD_LEVELS = {
            "0": { text: "åº§ä½å……è¶³", color: "text-emerald-400" },
            "1": { text: "åªæœ‰ä¼ä½", color: "text-yellow-400" },
            "2": { text: "è»Šå»‚å·²æ»¿", color: "text-red-400" }
        };

        async function fetchBus(stopId, etaId, loadId) {
            const api = `https://rt.data.gov.hk/v2/transport/citybus/eta/CTB/${stopId}/B3X`;
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(api)}`;

            try {
                const response = await fetch(proxyUrl);
                const result = await response.json();
                const data = JSON.parse(result.contents).data;

                if (data && data.length > 0) {
                    const bus = data[0];
                    // è¨ˆç®—æ™‚é–“
                    const diff = Math.round((new Date(bus.eta) - new Date()) / 60000);
                    document.getElementById(etaId).innerText = diff <= 0 ? "å³åˆ°" : diff + "m";
                    
                    // æ“æ“ åº¦é‚è¼¯
                    const crowd = bus.data_part_c;
                    const loadEl = document.getElementById(loadId);
                    if (crowd !== undefined && CROWD_LEVELS[crowd]) {
                        loadEl.innerText = CROWD_LEVELS[crowd].text;
                        loadEl.className = `text-[10px] mt-1 font-bold ${CROWD_LEVELS[crowd].color}`;
                    } else {
                        loadEl.innerText = "æš«ç„¡æ“æ“ æ•¸æ“š";
                        loadEl.className = "text-[10px] mt-1 text-slate-500";
                    }
                }
            } catch (err) {
                document.getElementById(etaId).innerText = "ERR";
                document.getElementById(loadId).innerText = "ç¶²çµ¡è¶…æ™‚";
            }
        }

        function refreshCCTV() {
            const t = Date.now();
            document.getElementById('cctv-north').src = "https://tdcctv.data.gov.hk/NT426F.JPG?t=" + t;
            document.getElementById('cctv-south').src = "https://tdcctv.data.gov.hk/NT423F.JPG?t=" + t;
        }

        function updateAll() {
            fetchBus("003433", "eta-north", "load-north"); // ç´…æ©‹å¾€å£å²¸
            fetchBus("001530", "eta-south", "load-south"); // ç´…æ©‹å¾€å¸‚å€
            refreshCCTV();
        }

        // æ¯ 30 ç§’æ›´æ–°å·´å£«ï¼Œæ¯ 60 ç§’æ›´æ–° CCTV
        setInterval(() => { fetchBus("003433", "eta-north", "load-north"); fetchBus("001530", "eta-south", "load-south"); }, 30000);
        setInterval(refreshCCTV, 60000);
        updateAll();
    </script>
</body>
